<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Book Service - Dynamo Detailing</title>
    <meta name="description" content="Book your professional auto detailing service with Dynamo Detailing. Choose your service, provide your details, and schedule your appointment.">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a th:href="@{/}" class="logo">Dynamo Detailing</a>
                <ul class="nav-menu">
                    <li><a th:href="@{/}">Home</a></li>
                    <li><a th:href="@{/about}">About</a></li>
                    <li><a th:href="@{/services}">Services</a></li>
                    <li><a th:href="@{/book}" class="btn btn-primary active">Book Now</a></li>
                    <li><a th:href="@{/contact}">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Booking Form Section -->
    <section class="form-section">
        <div class="container">
            <div class="section-title">
                <h1>Book Your Detailing Service</h1>
                <p>Fill out the form below to schedule your professional auto detailing appointment</p>
            </div>
            
            <div class="form-container">
                <!-- Display success/error messages -->
                <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
                <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>
                
                <form th:action="@{/book}" th:object="${booking}" method="post">
                    <!-- Service Selection -->
                    <div class="form-group">
                        <label for="service">Select Service *</label>
                        <select id="service" th:field="*{service.serviceId}" class="form-control" required onchange="updatePrice()">
                            <option value="">Choose a service...</option>
                            <option th:each="service : ${services}" 
                                    th:value="${service.serviceId}" 
                                    th:text="${service.serviceName} + ' - $' + ${service.price} + ' (' + ${service.durationMinutes} + ' min)'"
                                    th:data-price="${service.price}">
                                Service Option
                            </option>
                        </select>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('service')}" th:errors="*{service}"></div>
                    </div>

                    <!-- Price Display -->
                    <div class="form-group" id="priceDisplay" style="display: none;">
                        <label>Service Price</label>
                        <div style="font-size: 1.5rem; color: #dc3545; font-weight: bold;" id="selectedPrice">$0.00</div>
                    </div>

                    <!-- Customer Information -->
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #dc3545; margin-bottom: 1rem;">Your Information</h3>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" th:field="*{customer.firstName}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.firstName')} ? 'is-invalid' : ''" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.firstName')}" th:errors="*{customer.firstName}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" th:field="*{customer.lastName}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.lastName')} ? 'is-invalid' : ''" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.lastName')}" th:errors="*{customer.lastName}"></div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" th:field="*{customer.email}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.email')} ? 'is-invalid' : ''" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.email')}" th:errors="*{customer.email}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number *</label>
                            <input type="tel" id="phoneNumber" th:field="*{customer.phoneNumber}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.phoneNumber')} ? 'is-invalid' : ''" 
                                   placeholder="(555) 123-4567" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.phoneNumber')}" th:errors="*{customer.phoneNumber}"></div>
                        </div>
                    </div>

                    <!-- Customer Address Information -->
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #dc3545; margin-bottom: 1rem;">Your Address</h3>
                        <p style="color: #666; margin-bottom: 1rem;">Your billing/contact address (optional but recommended)</p>
                    </div>

                    <div class="form-group">
                        <label for="customerAddress">Street Address</label>
                        <input type="text" id="customerAddress" th:field="*{customer.address}" 
                               class="form-control" th:classappend="${#fields.hasErrors('customer.address')} ? 'is-invalid' : ''" 
                               placeholder="123 Main Street">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.address')}" th:errors="*{customer.address}"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="customerCity">City</label>
                            <input type="text" id="customerCity" th:field="*{customer.city}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.city')} ? 'is-invalid' : ''" 
                                   placeholder="Your City">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.city')}" th:errors="*{customer.city}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="customerState">State</label>
                            <select id="customerState" th:field="*{customer.state}" class="form-control">
                                <option value="">Select State...</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.state')}" th:errors="*{customer.state}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="customerZip">ZIP Code</label>
                            <input type="text" id="customerZip" th:field="*{customer.zipCode}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('customer.zipCode')} ? 'is-invalid' : ''" 
                                   placeholder="12345" pattern="[0-9]{5}(-[0-9]{4})?" title="ZIP Code format: 12345 or 12345-6789">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('customer.zipCode')}" th:errors="*{customer.zipCode}"></div>
                        </div>
                    </div>

                    <!-- Service Location -->
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #dc3545; margin-bottom: 1rem;">Service Location</h3>
                        <p style="color: #666; margin-bottom: 1rem;">Where would you like us to perform the service?</p>
                    </div>

                    <div class="form-group">
                        <label for="locationAddress">Street Address *</label>
                        <input type="text" id="locationAddress" th:field="*{locationAddress}" 
                               class="form-control" th:classappend="${#fields.hasErrors('locationAddress')} ? 'is-invalid' : ''" 
                               placeholder="123 Service Street" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('locationAddress')}" th:errors="*{locationAddress}"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="locationCity">City *</label>
                            <input type="text" id="locationCity" th:field="*{locationCity}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('locationCity')} ? 'is-invalid' : ''" 
                                   placeholder="Service City" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('locationCity')}" th:errors="*{locationCity}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="locationState">State *</label>
                            <select id="locationState" th:field="*{locationState}" class="form-control" required>
                                <option value="">Select State...</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('locationState')}" th:errors="*{locationState}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="locationZip">ZIP Code *</label>
                            <input type="text" id="locationZip" th:field="*{locationZip}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('locationZip')} ? 'is-invalid' : ''" 
                                   placeholder="12345" pattern="[0-9]{5}(-[0-9]{4})?" title="ZIP Code format: 12345 or 12345-6789" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('locationZip')}" th:errors="*{locationZip}"></div>
                        </div>
                    </div>

                    <!-- Quick Fill Option -->
                    <div class="form-group" style="text-align: center; margin: 1.5rem 0;">
                        <button type="button" onclick="copyCustomerAddressToService()" class="btn btn-outline" style="font-size: 0.9rem;">
                            📋 Use My Address for Service Location
                        </button>
                    </div>

                    <!-- Appointment Details -->
                    <div style="margin: 2rem 0;">
                        <h3 style="color: #dc3545; margin-bottom: 1rem;">Appointment Details</h3>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="bookingDate">Preferred Date *</label>
                            <input type="date" id="bookingDate" th:field="*{bookingDate}" 
                                   class="form-control" th:classappend="${#fields.hasErrors('bookingDate')} ? 'is-invalid' : ''" 
                                   th:min="${T(java.time.LocalDate).now().plusDays(1)}" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('bookingDate')}" th:errors="*{bookingDate}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="bookingTime">Preferred Time *</label>
                            <select id="bookingTime" th:field="*{bookingTime}" class="form-control" required>
                                <option value="">Select a time...</option>
                                <option value="08:00">8:00 AM</option>
                                <option value="09:00">9:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="13:00">1:00 PM</option>
                                <option value="14:00">2:00 PM</option>
                                <option value="15:00">3:00 PM</option>
                                <option value="16:00">4:00 PM</option>
                                <option value="17:00">5:00 PM</option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('bookingTime')}" th:errors="*{bookingTime}"></div>
                        </div>
                    </div>

                    <!-- Special Instructions -->
                    <div class="form-group">
                        <label for="specialInstructions">Special Instructions (Optional)</label>
                        <textarea id="specialInstructions" th:field="*{specialInstructions}" 
                                  class="form-control" rows="4" 
                                  placeholder="Any special requests, vehicle details, or additional information..."></textarea>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('specialInstructions')}" th:errors="*{specialInstructions}"></div>
                    </div>

                    <!-- Terms and Submit -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" required style="margin: 0;">
                            <span>I agree to the terms of service and understand that payment will be due upon completion of the service.</span>
                        </label>
                    </div>

                    <div class="form-group" style="text-align: center;">
                        <button type="submit" class="btn btn-primary btn-lg" style="margin-right: 1rem;">
                            Book Appointment
                        </button>
                        <a th:href="@{/services}" class="btn btn-outline">
                            View Services
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Dynamo Detailing</h3>
                    <p>Professional auto detailing services that bring out the best in your vehicle. We use premium products and techniques to ensure exceptional results every time.</p>
                </div>
                <div class="footer-section">
                    <h3>Services</h3>
                    <p><a th:href="@{/services}">Basic Wash</a></p>
                    <p><a th:href="@{/services}">Premium Wash</a></p>
                    <p><a th:href="@{/services}">Full Detail</a></p>
                    <p><a th:href="@{/services}">Interior Deep Clean</a></p>
                    <p><a th:href="@{/services}">Paint Correction</a></p>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p>📞 Phone: (555) 123-4567</p>
                    <p>✉️ Email: info@dynamodetailing.com</p>
                    <p>📍 Service Area: City-wide mobile service</p>
                    <p>🕒 Hours: Mon-Sat 8AM-6PM</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <p><a th:href="@{/}">Home</a></p>
                    <p><a th:href="@{/about}">About Us</a></p>
                    <p><a th:href="@{/book}">Book Service</a></p>
                    <p><a th:href="@{/contact}">Contact Us</a></p>
                    <p><a th:href="@{/admin/login}">Admin Login</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Dynamo Detailing. All rights reserved. | Professional Auto Detailing Services</p>
            </div>
        </div>
    </footer>

    <script>
        function updatePrice() {
            const serviceSelect = document.getElementById('service');
            const priceDisplay = document.getElementById('priceDisplay');
            const selectedPrice = document.getElementById('selectedPrice');
            
            if (serviceSelect.value) {
                const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
                const price = selectedOption.getAttribute('data-price');
                selectedPrice.textContent = '$' + parseFloat(price).toFixed(2);
                priceDisplay.style.display = 'block';
            } else {
                priceDisplay.style.display = 'none';
            }
        }

        function copyCustomerAddressToService() {
            const customerAddress = document.getElementById('customerAddress').value;
            const customerCity = document.getElementById('customerCity').value;
            const customerState = document.getElementById('customerState').value;
            const customerZip = document.getElementById('customerZip').value;
            
            if (customerAddress || customerCity || customerState || customerZip) {
                if (customerAddress) document.getElementById('locationAddress').value = customerAddress;
                if (customerCity) document.getElementById('locationCity').value = customerCity;
                if (customerState) document.getElementById('locationState').value = customerState;
                if (customerZip) document.getElementById('locationZip').value = customerZip;
                
                // Show a brief success indication
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '✅ Address Copied!';
                button.style.background = '#28a745';
                button.style.color = '#fff';
                button.style.border = '2px solid #28a745';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = 'transparent';
                    button.style.color = '#dc3545';
                    button.style.border = '2px solid #dc3545';
                }, 2000);
            } else {
                alert('Please fill in your address information first.');
            }
        }

        // Set minimum date to tomorrow
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('bookingDate');
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.min = tomorrow.toISOString().split('T')[0];
        });
    </script>
</body>
</html>
